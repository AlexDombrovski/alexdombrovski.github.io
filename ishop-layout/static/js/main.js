// -------------------------------
// creating a maps of items
const productData278009 = new Map([
  ['image', 'media/736d61727470686f6e65.jpg'],
  ['details', 'Диагональ экрана 6.0" / Камера: 3.2Mp / RAM: 4 Gb / 1100 mA/h / Вес: 720 g / WiFi / Bluetooth / Диктофон / USB'],
  ['name', 'Prestigio SH398187'],
  ['alt', 'Prestigio SH398187'],
  ['code', 278009],
  ['price', 570],
  ['currency', '$'],
  ['category', 'Смартфон'],
  ['producer', 'Prestigio']
]);

const productData278014 = new Map([
  ['image', 'media/652d626f6f6b.jpg'],
  ['details', 'Диагональ экрана 9.0" / Матрица: E lnk Pearl / Разрешение: 1600x1200 / Память 6 GB / Вес 190 g'],
  ['name', 'EvroMedia NU6353951'],
  ['alt', 'EvroMedia NU6353951'],
  ['code', 278014],
  ['price', 2710],
  ['currency', '$'],
  ['category', 'E-книга'],
  ['producer', 'EvroMedia']
]);

const productData278016 = new Map([
  ['image', 'media/736d61727470686f6e65.jpg'],
  ['details', 'Диагональ экрана 4.4" / Камера: 3.2Mp / RAM: 1 Gb / Blue / 1000 mA/h / Вес: 320г / 2 сим-карты / WiFi / USB / FM / Диктофон / 3G'],
  ['name', 'Huawei BIC2404'],
  ['alt', 'Huawei BIC2404'],
  ['code', 278018],
  ['price', 370],
  ['currency', '$'],
  ['category', 'Смартфон'],
  ['producer', 'Huawei']
]);

const productData278026 = new Map([
  ['image', 'media/7461626c6574.jpg'],
  ['details', 'Экран 9" / RAM 3 GB / HDD 370 GB / Black / Вес: 60 g / Bluetooth / 3G / USB / GPS'],
  ['name', 'Apple QR35378150'],
  ['alt', 'Apple QR35378150'],
  ['code', 278026],
  ['price', 2630],
  ['currency', '$'],
  ['category', 'Планшет'],
  ['producer', 'Apple']
]);

const productData278031 = new Map([
  ['image', 'media/7461626c6574.jpg'],
  ['details', 'Экран 7" / RAM 4 GB / HDD 320 GB / Silver / Вес: 260 g / HDMI / GPS / Bluetooth'],
  ['name', 'Acer JEQ0979832'],
  ['alt', 'Acer JEQ0979832'],
  ['code', 278031],
  ['price', 1670],
  ['currency', '$'],
  ['category', 'Планшет'],
  ['producer', 'Acer']
]);

const productData278039 = new Map([
  ['image', 'media/736d61727470686f6e65.jpg'],
  ['details', 'Экран 4.4" / Камера: 3.2Mp / RAM: 1 Gb / Black / 1700 mA/h / Вес: 800 g / Bluetooth / 3G / FM'],
  ['name', 'Samsung JL9994'],
  ['alt', 'Samsung JL9994'],
  ['code', 278039],
  ['price', 1130],
  ['currency', '$'],
  ['category', 'Смартфон'],
  ['producer', 'Samsung']
]);

const productData278044 = new Map([
  ['image', 'media/6d70332d706c61796572.jpg'],
  ['details', 'Экран 2.0" / RAM: 1 Gb / Black / 1000 mA/h / Вес: 60 g / Bluetooth / 3G / FM'],
  ['name', 'SanDisk-1245'],
  ['alt', 'SanDisk-1245'],
  ['code', 278044],
  ['price', 50],
  ['currency', '$'],
  ['category', 'Смарт-плеер'],
  ['producer', 'SanDisk']
]);

const productData278046 = new Map([
  ['image', 'media/6e6f7465626f6f6b.jpg'],
  ['details', 'Экран 15.0" / RAM: 8 Gb / SDD: 128GB / Grey / Вес: 2 kg / Bluetooth / WiFi'],
  ['name', 'Asus 34567SU'],
  ['alt', 'ASUS 34567SU'],
  ['code', 278046],
  ['price', 1848],
  ['currency', '$'],
  ['category', 'Ноутбук'],
  ['producer', 'Asus']
]);

const productData278050 = new Map([
  ['image', 'media/736d6172747761746368.jpg'],
  ['details', 'Экран 2.8" / RAM: 128 Mb / Grey / Вес: 65 g / Bluetooth / 1000 mA/h / miniUSB'],
  ['name', 'Garmin 34567SU'],
  ['alt', 'GARMIN 34567SU'],
  ['code', 278050],
  ['price', 160],
  ['currency', '$'],
  ['category', 'Умные часы'],
  ['producer', 'Garmin']
]);

const productData278052 = new Map([
  ['image', 'media/736d61727470686f6e65.jpg'],
  ['details', 'Диагональ экрана 4.4" / Камера: 3.2Mp / RAM: 1 Gb / Blue / 1000 mA/h / Вес: 320г / 2 сим-карты / WiFi / USB / FM / Диктофон / 3G'],
  ['name', 'Huawei BIC2404'],
  ['alt', 'Huawei BIC2404'],
  ['code', 278052],
  ['price', 370],
  ['currency', '$'],
  ['category', 'Смартфон'],
  ['producer', 'Huawei']
]);

const productData278054 = new Map([
  ['image', 'media/652d626f6f6b.jpg'],
  ['details', 'Диагональ экрана 9.0" / Матрица: E lnk Pearl / Разрешение: 1600x1200 / Память 6 GB / Вес 190 g'],
  ['name', 'EvroMedia NU6353951'],
  ['alt', 'EvroMedia NU6353951'],
  ['code', 278054],
  ['price', 2710],
  ['currency', '$'],
  ['category', 'E-книга'],
  ['producer', 'EvroMedia']
]);

const productData278056 = new Map([
  ['image', 'media/70686f6e65.jpg'],
  ['details', 'Экран 7" / RAM 4 GB / HDD 320 GB / Silver / Вес: 260 g / HDMI / GPS / Bluetooth'],
  ['name', 'Alcatel JEQ0979832'],
  ['alt', 'Alcatel JEQ0979832'],
  ['code', 278056],
  ['price', 1670],
  ['currency', '$'],
  ['category', 'Телефон'],
  ['producer', 'Alcatel']
]);

// creating a massife of items
let allProductData = [
  productData278009,
  productData278014,
  productData278016,
  productData278026,
  productData278031,
  productData278039,
  productData278044,
  productData278046,
  productData278050,
  productData278052,
  productData278054,
  productData278056
];

// -------------------------------
// modal window DOM
let productPopup = document.querySelector('#addProductPopup'),
  modalImage = document.querySelector('.product-image'),
  modalName = document.querySelector('.name-popup'),
  modalCategory = document.querySelector('.category-popup'),
  modalProducer = document.querySelector('.producer-popup'),
  modalPrice = document.querySelector('.price-popup'),
  modalCount = document.querySelector('.count'),
  modalCost = document.querySelector('.cost');

// -------------------------------
// Button for adding Product To Cart + indicator
const addToCartButton = document.querySelector('#addToCart'),
  addToCartIndicator = document.querySelector('#addToCartIndicator');

// -------------------------------
// costCounter function  
const costCounter = () => {
  modalCost.innerText = '$ ' + (modalPrice.innerText.slice(2, 10) * modalCount.value).toFixed(2);
};

// -------------------------------
// Creating items
allProductData.forEach((productData) => {
  let image = productData.get('image'),
    details = productData.get('details'),
    name = productData.get('name'),
    alt = productData.get('alt'),
    code = productData.get('code'),
    price = productData.get('price'),
    currency = productData.get('currency'),
    category = productData.get('category'),
    producer = productData.get('producer');


  // createElement
  const productListParrent = document.querySelector('.productList__parrent');

  let divColumn = document.createElement('div');
  divColumn.className = 'col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xlg-2';
  productListParrent.append(divColumn);

  let divIdProduct = document.createElement('div');
  divIdProduct.className = 'panel panel-default product';
  divColumn.append(divIdProduct);

  let divPanelBody = document.createElement('div');
  divPanelBody.className = 'panel-body';
  divIdProduct.append(divPanelBody);

  let divThumbnail = document.createElement('div');
  divThumbnail.className = 'thumbnail';
  divPanelBody.append(divThumbnail);

  let imgThumbnail = document.createElement('img');
  imgThumbnail.className = 'thumbnail-img';
  imgThumbnail.setAttribute('src', image);
  imgThumbnail.setAttribute('alt', alt);
  divThumbnail.append(imgThumbnail);

  let divDescription = document.createElement('div');
  divDescription.className = 'desc';
  divThumbnail.append(divDescription);

  let divCell = document.createElement('div');
  divCell.className = 'cell';
  divDescription.append(divCell);

  let pCell = document.createElement('p');
  pCell.innerText = details;
  divCell.append(pCell);

  let spanTitle = document.createElement('span');
  spanTitle.className = 'title';
  spanTitle.innerText = 'Описание:';
  pCell.prepend(spanTitle);

  let h4 = document.createElement('h4');
  h4.className = 'name';
  h4.innerText = name;
  divPanelBody.append(h4);

  let divCode = document.createElement('div');
  divCode.className = 'code';
  divCode.innerText = code;
  divPanelBody.append(divCode);

  let spanCode = document.createElement('span');
  spanCode.className = 'span-code';
  spanCode.innerText = 'Код: ';
  divCode.prepend(spanCode);

  let divPrice = document.createElement('div');
  divPrice.className = 'price';
  divPrice.innerText = price;
  divPanelBody.append(divPrice);

  let spanPrice = document.createElement('span');
  spanPrice.className = 'currency';
  spanPrice.innerText = `${currency} `;
  divPrice.prepend(spanPrice);

  let aBuyButton = document.createElement('a');
  aBuyButton.className = 'btn btn-primary pull-right buy-btn';
  aBuyButton.innerText = 'Купить';
  aBuyButton.onclick = () => showPopup(code);
  divPanelBody.append(aBuyButton);

  let divListGroup = document.createElement('div');
  divListGroup.className = 'list-group';
  divPanelBody.append(divListGroup);

  let spanGroupCategory = document.createElement('span');
  spanGroupCategory.className = 'list-group-item';
  divListGroup.prepend(spanGroupCategory);

  let smallCategory = document.createElement('small');
  smallCategory.innerText = 'Категория: ';
  spanGroupCategory.prepend(smallCategory);

  let spanСategory = document.createElement('span');
  spanСategory.className = 'category';
  spanСategory.innerText = category;
  spanGroupCategory.append(spanСategory);

  let spanGroupProducer = document.createElement('span');
  spanGroupProducer.className = 'list-group-item';
  divListGroup.append(spanGroupProducer);

  let smallProducer = document.createElement('small');
  smallProducer.innerText = 'Производитель: ';
  spanGroupProducer.prepend(smallProducer);

  let spanProducer = document.createElement('span');
  spanProducer.className = 'producer';
  spanProducer.innerText = producer;
  spanGroupProducer.append(spanProducer);

  // Show Popup
  const showPopup = () => {
    productPopup.classList.remove('modal');
    productPopup.classList.add('in');
    modalImage.setAttribute('src', image);
    modalName.innerText = name;
    modalCategory.innerText = category;
    modalProducer.innerText = producer;
    modalPrice.innerText = `${currency} ` + price;
    modalCost.innerText = modalCount.value * price;
    addToCartButton.classList.remove('hidden');
    addToCartIndicator.classList.add('hidden');
    modalCount.value = modalCount.getAttribute('min');
    addToCartButton.onclick = () => addProductToCart(code);
    costCounter();
  };
});

// -------------------------------
// Modal close function
const modalClose = () => {
  document.querySelector('#addProductPopup').classList.add('modal');
};

// -------------------------------
// Add item to cart
const addProductToCart = (code) => {
  addToCartButton.classList.add('hidden');
  addToCartIndicator.classList.remove('hidden');
  setTimeout(() => {
    let oldData = JSON.parse(localStorage.getItem('ishopBasket')) || [];

    let productMap = allProductData.find(item => item.get('code') === code);

    const data = [
      ...oldData,
      {
        code,
        count: modalCount.value,
        name: productMap.get('name'),
        image: productMap.get('image'),
        price: productMap.get('price'),
        currency: productMap.get('currency'),
      }
    ];

    localStorage.setItem('ishopBasket', JSON.stringify(data));

    const totalCount = data.reduce((sum, obj) => sum + +obj.count, 0);

    const totalCost = data.reduce((sum, obj) => {
      productMap = allProductData.find(item => item.get('code') === obj.code);
      return sum + (productMap.get('price') * +obj.count);
    }, 0);


    document.querySelectorAll('#currentShoppingCart .total-count').forEach(item => item.innerText = totalCount);
    document.querySelector('#currentShoppingCart .total-cost').innerText = totalCost;
    document.querySelector('#currentShoppingCart').classList.remove('hidden');
    document.querySelector('#addProductPopup').classList.add('modal');
  }, 800);
};

// -------------------------------
// Clean a basket
const cleanBasketButton = () => {
  localStorage.removeItem('ishopBasket');
  document.querySelectorAll('#currentShoppingCart .total-count').forEach(item => item.innerText = 0);
  document.querySelector('#currentShoppingCart .total-cost').innerText = 0;
};

// -------------------------------
// Show more Button
const showMore = () => {
  document.querySelector('.btn-success').classList.add('hidden');
  document.querySelector('#loadMoreIndicator').classList.remove('hidden');
  setTimeout(() => {
    document.querySelector('#loadMoreIndicator').classList.add('hidden');
    document.querySelector('.more-fiction').classList.remove('hidden');
  }, 800);
}